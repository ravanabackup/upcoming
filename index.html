<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Material You - Ultimate Cinema Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --bg: #1a1c1e;
            --surface: #2d2f31;
            --surface-variant: #43474e;
            --primary: #d1e4ff;
            --on-primary: #00315c;
            --secondary: #bfc8d5;
            --text: #e2e2e6;
            --text-variant: #c2c7cf;
            --success: #4caf50;
            --warning: #ff9800;
        }
        body { font-family: 'Google Sans', 'Roboto', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; overflow-x: hidden; }
        header { padding: 30px 20px; display: flex; flex-direction: column; align-items: center; gap: 20px; background: linear-gradient(180deg, #121314 0%, var(--bg) 100%); }
        h1 { margin: 0; font-weight: 400; font-size: 2.2rem; color: var(--primary); }
        .search-container { width: 100%; max-width: 600px; }
        .search-bar { width: 100%; padding: 18px 26px; border-radius: 50px; border: none; background: var(--surface-variant); color: white; font-size: 16px; outline: none; box-sizing: border-box; transition: 0.3s; }
        .search-bar:focus { background: #50545c; box-shadow: 0 0 0 2px var(--primary); }
        h2 { font-weight: 500; margin: 40px 20px 10px; color: var(--secondary); font-size: 1.4rem; border-left: 4px solid var(--primary); padding-left: 15px; }
        .hidden { display: none; }
        .marquee-container { width: 100%; background: var(--surface); padding: 24px 0; overflow: hidden; white-space: nowrap; position: relative; border-bottom: 1px solid var(--surface-variant); }
        .marquee-content { display: inline-flex; gap: 24px; animation: scroll-left 120s linear infinite; }
        @keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; padding: 20px; }
        .card { background: var(--surface); border-radius: 32px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid rgba(255,255,255,0.05); transition: transform 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .poster-box { width: 100%; background: #000; display: flex; justify-content: center; align-items: center; min-height: 450px; overflow: hidden; cursor: pointer; position: relative; }
        .poster-box:hover::after { content: 'üîç View IMDb Info'; position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 12px 24px; border-radius: 25px; font-size: 14px; font-weight: 600; }
        .card img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .status-badge { position: absolute; top: 15px; right: 15px; background: var(--success); color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; z-index: 1; }
        .status-upcoming { background: var(--warning); }
        .info { padding: 24px; display: flex; flex-direction: column; gap: 8px; flex-grow: 1; }
        .title { font-size: 19px; font-weight: 500; color: var(--primary); margin: 0; min-height: 2.4em; }
        .score-bar { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
        .score-circle { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; border: 3px solid; }
        .score-high { border-color: var(--success); color: var(--success); }
        .score-med { border-color: var(--warning); color: var(--warning); }
        .score-low { border-color: #f44336; color: #f44336; }
        .details { font-size: 13px; color: var(--text-variant); line-height: 1.8; margin-bottom: 10px; }
        .details strong { color: var(--primary); }
        .button-group { display: flex; gap: 10px; margin-top: auto; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 16px; cursor: pointer; font-weight: 600; font-size: 13px; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: var(--on-primary); }
        .btn-secondary { background: var(--surface-variant); color: var(--primary); }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }
        .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(12px); }
        .modal-content { background: var(--bg); margin: 2vh auto; padding: 30px; border-radius: 32px; width: 90%; max-width: 900px; max-height: 90vh; overflow-y: auto; border: 1px solid var(--surface-variant); }
        .close { float: right; font-size: 30px; cursor: pointer; color: var(--text-variant); transition: 0.2s; }
        .close:hover { color: var(--primary); }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 24px; margin-top: 20px; background: #000; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .cast-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 20px; margin-top: 20px; }
        .cast-card { text-align: center; background: var(--surface); padding: 15px; border-radius: 20px; transition: 0.3s; }
        .cast-card:hover { transform: translateY(-5px); background: var(--surface-variant); }
        .cast-card img { width: 100%; height: 180px; object-fit: cover; border-radius: 15px; background: var(--surface-variant); }
        .modal-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; padding: 20px; background: var(--surface); border-radius: 20px; }
        .detail-item { display: flex; flex-direction: column; gap: 5px; }
        .detail-label { font-size: 12px; color: var(--text-variant); text-transform: uppercase; letter-spacing: 1px; }
        .detail-value { font-size: 16px; color: var(--primary); font-weight: 500; }
        .imdb-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; margin-top: 20px; }
        .imdb-card { text-align: center; background: var(--surface); padding: 15px; border-radius: 20px; transition: 0.3s; cursor: pointer; }
        .imdb-card:hover { transform: translateY(-5px); background: var(--surface-variant); }
        .imdb-card img { width: 100%; height: 220px; object-fit: cover; border-radius: 15px; background: var(--surface-variant); }
        .loading { text-align: center; padding: 40px; color: var(--text-variant); }
        .loading::after { content: '...'; animation: dots 1.5s steps(4, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
    </style>
</head>
<body>

    <header>
        <h1>üé¨ Cinema Dashboard</h1>
        <div class="search-container">
            <input type="text" id="searchInput" class="search-bar" placeholder="Search any movie (e.g. Inception, Avatar)...">
        </div>
    </header>

    <section id="search-section" class="hidden">
        <h2>üîç Search Results</h2>
        <div id="search-grid" class="grid"></div>
    </section>

    <section>
        <h2>üî• Now Playing</h2>
        <div class="marquee-container">
            <div class="marquee-content" id="now-playing-list"></div>
        </div>
    </section>

    <section>
        <h2>üìÖ Upcoming Malayalam</h2>
        <div id="malayalam-grid" class="grid"></div>
    </section>

    <section>
        <h2>üìÖ Upcoming Hindi</h2>
        <div id="hindi-grid" class="grid"></div>
    </section>

    <div id="mainModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <h2 id="modalTitle" style="margin:0; color: var(--primary);"></h2>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        const API_KEY = "29d877505bbee7b5e97716a14b0af4c7";
        const BASE_IMG = "https://image.tmdb.org/t/p/w500";
        const PROFILE_IMG = "https://image.tmdb.org/t/p/w185";
        const TODAY = new Date().toISOString().split('T')[0];

        const URLS = {
            "now-playing": `https://api.themoviedb.org/3/movie/now_playing?api_key=${API_KEY}&language=en-US&page=1`,
            "malayalam": `https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&with_original_language=ml&primary_release_date.gte=${TODAY}&sort_by=primary_release_date.asc`,
            "hindi": `https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&with_original_language=hi&primary_release_date.gte=${TODAY}&sort_by=primary_release_date.asc`
        };

        function getScoreClass(score) {
            if (score >= 70) return 'score-high';
            if (score >= 50) return 'score-med';
            return 'score-low';
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'TBA';
            const d = new Date(dateStr);
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            return `${day}-${month}-${year}`;
        }

        function getStatus(releaseDate) {
            if (!releaseDate) return { text: 'Unknown', class: '' };
            const release = new Date(releaseDate);
            const now = new Date();
            if (release <= now) return { text: 'Released', class: '' };
            return { text: 'Upcoming', class: 'status-upcoming' };
        }

        // IMDb search function
        async function showImdbFallbacks(title) {
            const modal = document.getElementById('mainModal');
            const body = document.getElementById('modalBody');
            document.getElementById('modalTitle').innerText = `üé≠ IMDb Explorer: ${title}`;
            body.innerHTML = '<p class="loading">Searching IMDb database</p>';
            modal.style.display = 'block';
            
            try {
                const searchQuery = title.toLowerCase().replace(/[^a-z0-9\s]/g, '').replace(/\s+/g, '_');
                const res = await fetch(`https://v2.sg.media-imdb.com/suggestion/${searchQuery.charAt(0)}/${searchQuery}.json`);
                const data = await res.json();
                
                if (!data.d || data.d.length === 0) {
                    body.innerHTML = '<p style="text-align:center; padding: 40px; color: var(--text-variant);">No IMDb matches found for this title. Try searching with a different name.</p>';
                    return;
                }

                let html = '<div class="imdb-grid">';
                data.d.slice(0, 20).forEach(item => {
                    const img = item.i && item.i.imageUrl ? item.i.imageUrl : 'https://placehold.co/185x278/222/fff?text=No+Poster';
                    const year = item.y ? item.y : '';
                    const starring = item.s ? item.s : '';
                    const imdbId = item.id ? item.id : '';
                    const imdbLink = imdbId ? `https://www.imdb.com/title/${imdbId}/` : '#';
                    
                    html += `
                        <div class="imdb-card" onclick="window.open('${imdbLink}', '_blank')">
                            <img src="${img}" alt="${item.l}">
                            <p style="color:var(--primary);font-size:15px;margin:12px 0 4px;font-weight:500;line-height:1.3;">${item.l}</p>
                            ${year ? `<p style="font-size:12px; color:var(--warning); margin: 4px 0;">${year}</p>` : ''}
                            ${starring ? `<p style="font-size:11px; color:var(--text-variant); line-height: 1.4; margin-top: 6px;">${starring}</p>` : ''}
                        </div>`;
                });
                html += '</div>';
                html += '<p style="text-align:center; margin-top: 25px; font-size: 13px; color: var(--text-variant);">üí° Click any card to open on IMDb.com</p>';
                body.innerHTML = html;
            } catch (e) { 
                console.error('IMDb fetch error:', e);
                body.innerHTML = '<p style="text-align:center; padding: 40px; color: #f44336;">‚ö†Ô∏è Error connecting to IMDb. Please try again later.</p>'; 
            }
        }

        async function createCard(movie) {
            const hasPoster = !!movie.poster_path;
            const posterUrl = hasPoster ? BASE_IMG + movie.poster_path : `https://placehold.co/500x750/333/fff?text=${encodeURIComponent(movie.title)}`;
            const score = movie.vote_average ? Math.round(movie.vote_average * 10) : 0;
            const scoreClass = getScoreClass(score);
            const status = getStatus(movie.release_date);
            const safeTitle = (movie.title || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
            
            const div = document.createElement('div');
            div.className = 'card';

            div.innerHTML = `
                <div class="poster-box" onclick="showImdbFallbacks('${safeTitle}')">
                    <img src="${posterUrl}" alt="${movie.title}" loading="lazy">
                    ${status.text !== 'Unknown' ? `<span class="status-badge ${status.class}">${status.text}</span>` : ''}
                </div>
                <div class="info">
                    <p class="title">${movie.title}</p>
                    <div class="score-bar">
                        <div class="score-circle ${scoreClass}">
                            ${score > 0 ? score + '%' : 'NR'}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 12px; color: var(--text-variant);">User Score</div>
                            <div style="font-size: 11px; color: var(--text-variant); margin-top: 2px;">
                                ${movie.vote_count || 0} votes
                            </div>
                        </div>
                    </div>
                    <div class="details">
                        <strong>Release:</strong> ${formatDate(movie.release_date)}<br>
                        <strong>Status:</strong> ${status.text}
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="event.stopPropagation(); showCast(${movie.id})">üë• Cast</button>
                        <button class="btn btn-secondary" onclick="event.stopPropagation(); showDetails(${movie.id})">‚ÑπÔ∏è Details</button>
                    </div>
                </div>`;
            return div;
        }

        async function showCast(id) {
            try {
                const modal = document.getElementById('mainModal');
                const body = document.getElementById('modalBody');
                document.getElementById('modalTitle').innerText = "Cast & Crew";
                body.innerHTML = '<p class="loading">Loading cast information</p>';
                modal.style.display = 'block';
                
                const res = await fetch(`https://api.themoviedb.org/3/movie/${id}/credits?api_key=${API_KEY}`);
                const data = await res.json();
                
                let html = '<h3 style="color: var(--secondary); margin-top: 0;">Cast Members</h3><div class="cast-grid">';
                (data.cast || []).slice(0, 12).forEach(c => {
                    const img = c.profile_path ? PROFILE_IMG+c.profile_path : 'https://placehold.co/185x278/444/fff?text=No+Photo';
                    html += `<div class="cast-card"><img src="${img}"><p style="color:var(--primary);margin:8px 0 2px;font-size:14px;font-weight:500;">${c.name}</p><p style="font-size:11px; color:var(--text-variant);">${c.character || 'Unknown Role'}</p></div>`;
                });
                html += '</div>';
                
                if (data.crew && data.crew.length > 0) {
                    const director = data.crew.find(c => c.job === 'Director');
                    if (director) {
                        html += `<h3 style="color: var(--secondary); margin-top: 30px;">Director</h3>`;
                        html += `<div class="cast-grid">`;
                        const img = director.profile_path ? PROFILE_IMG+director.profile_path : 'https://placehold.co/185x278/444/fff?text=No+Photo';
                        html += `<div class="cast-card"><img src="${img}"><p style="color:var(--primary);margin:8px 0 2px;font-size:14px;font-weight:500;">${director.name}</p><p style="font-size:11px; color:var(--text-variant);">Director</p></div>`;
                        html += '</div>';
                    }
                }
                
                body.innerHTML = (data.cast?.length || data.crew?.length) ? html : '<p style="text-align:center; padding: 40px;">No cast information available.</p>';
            } catch(e) { 
                console.error(e);
                document.getElementById('modalBody').innerHTML = '<p style="text-align:center; padding: 40px; color: #f44336;">‚ö†Ô∏è Error loading cast information.</p>';
            }
        }

        async function showDetails(id) {
            try {
                const modal = document.getElementById('mainModal');
                const body = document.getElementById('modalBody');
                body.innerHTML = '<p class="loading">Loading movie details</p>';
                modal.style.display = 'block';
                
                const res = await fetch(`https://api.themoviedb.org/3/movie/${id}?api_key=${API_KEY}&append_to_response=videos,credits`);
                const d = await res.json();
                const trailer = d.videos?.results.find(v => v.type === 'Trailer') || d.videos?.results[0];
                const score = d.vote_average ? Math.round(d.vote_average * 10) : 0;
                const scoreClass = getScoreClass(score);
                const status = getStatus(d.release_date);
                const director = d.credits?.crew?.find(c => c.job === 'Director');
                
                document.getElementById('modalTitle').innerText = d.title;
                
                let html = `
                    <div class="modal-details">
                        <div class="detail-item">
                            <span class="detail-label">Score</span>
                            <span class="detail-value">
                                <span class="score-circle ${scoreClass}" style="width: 60px; height: 60px; font-size: 16px;">
                                    ${score > 0 ? score + '%' : 'NR'}
                                </span>
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status</span>
                            <span class="detail-value">${status.text}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Director</span>
                            <span class="detail-value">${director ? director.name : 'Unknown'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Release Date</span>
                            <span class="detail-value">${formatDate(d.release_date)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Runtime</span>
                            <span class="detail-value">${d.runtime ? d.runtime + ' min' : 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Budget</span>
                            <span class="detail-value">${d.budget ? '$' + (d.budget / 1000000).toFixed(1) + 'M' : 'N/A'}</span>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--secondary); margin-top: 20px;">Overview</h3>
                    <p style="line-height:1.8; color: var(--text-variant);">${d.overview || 'No description available.'}</p>
                    
                    <p style="margin-top: 15px;"><strong style="color: var(--primary);">Genres:</strong> <span style="color: var(--text-variant);">${d.genres?.map(g => g.name).join(', ') || 'N/A'}</span></p>
                    
                    ${trailer ? `<h3 style="color: var(--secondary); margin-top: 25px;">Trailer</h3><div class="video-container"><iframe src="https://www.youtube.com/embed/${trailer.key}" allowfullscreen></iframe></div>` : '<p style="margin-top:20px; color:var(--warning);">‚ö†Ô∏è No Trailer Available</p>'}
                `;
                
                body.innerHTML = html;
            } catch(e) { 
                console.error(e);
                document.getElementById('modalBody').innerHTML = '<p style="text-align:center; padding: 40px; color: #f44336;">‚ö†Ô∏è Error loading movie details.</p>';
            }
        }

        document.getElementById('searchInput').addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                const q = e.target.value.trim();
                if (!q) return;
                const grid = document.getElementById('search-grid');
                document.getElementById('search-section').classList.remove('hidden');
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align:center; padding: 40px; color: var(--text-variant);" class="loading">Searching world database</p>';
                
                try {
                    const res = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(q)}`);
                    const data = await res.json();
                    grid.innerHTML = '';
                    if(data.results.length === 0) {
                        grid.innerHTML = '<p style="grid-column: 1/-1; text-align:center; padding: 40px; color: var(--text-variant);">No movies found. Try a different title.</p>';
                    } else {
                        for(let m of data.results.slice(0, 20)) {
                            grid.appendChild(await createCard(m));
                        }
                    }
                    window.scrollTo({top: 0, behavior: 'smooth'});
                } catch(err) {
                    grid.innerHTML = '<p style="grid-column: 1/-1; text-align:center; padding: 40px; color: #f44336;">‚ùå Search failed. Please check your connection.</p>';
                }
            }
        });

        async function init() {
            for (const [key, url] of Object.entries(URLS)) {
                try {
                    const res = await fetch(url);
                    const data = await res.json();
                    const target = key === 'now-playing' ? 'now-playing-list' : key + '-grid';
                    const container = document.getElementById(target);
                    if (!container) continue;
                    
                    const limit = key === 'now-playing' ? 20 : 12;
                    for (const m of data.results.slice(0, limit)) {
                        container.appendChild(await createCard(m));
                    }
                    
                    // Loop the marquee for "Now Playing"
                    if (key === 'now-playing') {
                        container.innerHTML += container.innerHTML;
                    }
                } catch (err) { 
                    console.error("Load failed for " + key, err);
                    const container = document.getElementById(key === 'now-playing' ? 'now-playing-list' : key + '-grid');
                    if (container && key !== 'now-playing') {
                        container.innerHTML = '<p style="color: var(--text-variant); padding: 20px; grid-column: 1/-1; text-align: center;">Failed to load movies. Please refresh the page.</p>';
                    }
                }
            }
        }

        document.getElementById('closeModal').onclick = () => document.getElementById('mainModal').style.display = 'none';
        window.onclick = (e) => { if(e.target.id === 'mainModal') document.getElementById('mainModal').style.display = 'none'; };

        init();
    </script>
</body>
</html>
